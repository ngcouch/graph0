<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">

    <script type="text/javascript" src="jsPsych/jspsych.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-survey-text.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-html-slider-response.js"></script>
    <link href="jsPsych/css/jspsych.css" rel="stylesheet" type="text/css"/>

  </head>
  <body>
  </body>

  <script>

    var ID = window.prompt("Enter your participant ID:")

    /*
    while (!Object.keys(conditions).includes(ID)) {

	var ID = window.prompt("ID not found. Please check again, or contact the experimenter.")

    }
    */

    // Create a function that takes an ordered pair of strings A, B and return a list containing two jsPsych trials. The first trial probes the edge between the strings, and the second provides feedback on the participant's response.

    function trial_pair(A, B, relation = "knows", present = true, randomize=false) {

	var trials = []

	trial_stim = "<p>" A + " " + relation + " " + B + "</p>"

	var stim_trial = {type: "html-keyboard-response",
		      stimulus: "TBD",
		      choices: [70, 74],
		      data: {present: present},
		      on_finish: function(data) {
			  if ((data.keypress == 70)==present) {

			      data.correct = true;
			  
			  }
			  else {
			      data.correct = false;
			  }
		      }
		     }

	var feedback_trial = {type: "html-keyboard-response",
			      stimulus: trial_stim + function() {
				  var last_trial = jsPsych.data.get().last(1).values()[0].correct;
				  if (last_trial) {
				      return "<p><big>Correct!</big></p>"
				  }
				  else {
				      return "<p><big>Incorrect!</big></p>"
				  }
			      },
			      response_ends_trial: function() {
				  var last_trial = jsPsych.data.get().last(1).values()[0].correct;
				  if (last_trial) {
				      return 500
				  }
				  else {
				      return 1000
				  }
			      }
			     }
			      	
	return [stim_trial, feedback_trial]

    }
    
    // Structure and assemble the experiment.
    
    var timeline = []

    var welcome = {type: "html-keyboard-response",
		   stimulus: "Welcome to the experiment, and thank you for your time! Press any key to continue."
		  };
    timeline.push(welcome)

    var instructions = {type: "html-keyboard-response",
			stimulus: "<p style='text-align:left;max-width:800px;'>In this experiment, you will be pairs of items and will be asked to decide if they go together or not. If you decide they go together, press <big>F</big>. If they do not, press <big>J</big>. After your guess, you will be told if you are correct. You will repeat this process multiple times.</p> <p>Press spacebar to continue.</p>",
			choices: [32]
		       };

	timeline.push(instructions)

	trials_array = trial_pair("John", "Mary", present = false)

    for (let i = 0, i < trials_array.length; i++ {

	timeline.push(trials_array[i][0])
	timeline.oush(trials_array[i][1])
	
    }
	 

	

    
    jsPsych.init({
	timeline: timeline,
	on_finish: function() {
	    $.ajax({
		type: "POST",
		url: "/experiment-data",
		data: jsPsych.data.get().json(),
		contentType: "application/json"
	    })
		.done(function() {
		    alert("Thank you!")
		})
		.fail(function() {
		    alert("A problem occurred while writing to the database. Please contact the researcher for more information.")
		})
	}
    })

    </script>
</html>
