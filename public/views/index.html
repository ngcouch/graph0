<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">

    <script type="text/javascript" src="jsPsych/jspsych.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-survey-text.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-html-slider-response.js"></script>
    <script type="text/javascript" src="experiment-data/functions.js"></script>
    <script type="text/javascript" src="experiment-data/networks.js"></script>
    <script type="text/javascript" src="experiment-data/conditions.js"></script>
    <link href="jsPsych/css/jspsych.css" rel="stylesheet" type="text/css"/>

  </head>
  <body>
  </body>

  <script>

    var ID = window.prompt("Enter your participant ID:")

    
    while (!Object.keys(conditions).includes(ID)) {

	var ID = window.prompt("ID not found. Please check again, or contact the experimenter.")

    }

    var condition = conditions[ID]
		       

    // Structure and assemble the experiment.
    
    var timeline = []

    var welcome = {type: "html-keyboard-response",
		   stimulus: "Welcome to the experiment, and thank you for your time! Press any key to continue."
		  };
    timeline.push(welcome)

    var instructions = {type: "html-keyboard-response",
			stimulus: "<p style='text-align:left;max-width:800px;'>In this experiment, you will be pairs of items and will be asked to decide if they go together or not. If you decide they go together, press <big>F</big>. If they do not, press <big>J</big>. After your guess, you will be told if you are correct. You will repeat this process multiple times.</p> <p>Press spacebar to continue.</p>",
			choices: [32]
		       };

    timeline.push(instructions)

    // create and push the network trials
    // First, loop over the desired number of blocks, constructing a random order of trials
    // for each

    var block = 0
    var index = 0
    var block_num = 5
    var block_array = []
    var trials_array = []
    
    // relabel the nodes

    var letters  = ["A", "B", "C", "D", "E", "F", "G"]
    var lettersR = jsPsych.randomization.shuffle(letters)
    var assignments = {"A": lettersR[0],
		       "B": lettersR[1],
		       "C": lettersR[2],
		       "D": lettersR[3],
		       "E": lettersR[4],
		       "F": lettersR[5],
		       "G": lettersR[6]}

    
    for(block = 0; block < block_num; block++) {

	block_array = []
	
	for (index = 0; index < network.length; index++){

	    var trials = trial_pair(assignments[network[index][0]], assignments[network[index][1]],relation = condition, present = network[index][2], block = block)

	    block_array.push(trials)

	}

	block_array = jsPsych.randomization.shuffle(block_array)


	for (index = 0; index < block_array.length; index++) {

	    trials_array.push(block_array[index][0])
	    trials_array.push(block_array[index][1])

	}

    }

    for(index = 0; index < trials_array.length; index ++) {

	timeline.push(trials_array[index])
	
    }
    

			 
    jsPsych.init({
	timeline: timeline,
	on_finish: function() {
	    $.ajax({
		type: "POST",
		url: "/experiment-data",
		data: jsPsych.data.get().json(),
		contentType: "application/json"
	    })
		.done(function() {
		    alert("Thank you!")
		})
		.fail(function() {
		    alert("A problem occurred while writing to the database. Please contact the researcher for more information.")
		})
	}
    })

    </script>
</html>
